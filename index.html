<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/imgs/VidEnhance2.png">
    <link rel="stylesheet" href="style.css" />
    <title>Video Upload Page</title>
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><img src="/imgs/VidEnhance2.png" alt="Logo"></li>
          <li><a href="index.html">Enhance</a></li>
          <li><a href="/research">Research</a></li>
          <li><a href="/quiz">Quiz</a></li>
          <li><a href="/tools">Tools</a></li>
          <li><a href="disclaimer.html">Disclaimer</a></li>
          <li><a href="dashboard.html">Developer Dashboard</a></li>
        </ul>
      </nav>
    </header>
    <main>
      <div id="menuModal" class="modal">
        <div class="modal-content">
          <h2>We're working on it!</h2>
          <p class="uuid-descriptor">
            Your file is being rendered, copy this code to check later!
          </p>
          <div id="uuid-bg">
            <p id="uuid"></p>
            <img
              src="imgs/copy-white.png"
              id="copy-uuid"
              class="png-icon"
              alt="copy icon"
            />
            <div id="toast" class="hide">Text copied!</div>
          </div>
          <span id="closeModal" class="close">&times;</span>
        </div>
      </div>
      <h1>Video <span class="titleColour">Enhancer</span></h1>
      <p class="subTitle">
        Try VidEnhance to instantly improve video quality! This can include
        resolution, sharpness, brightness and colouring!
      </p>
      <div class="enhancer-container">
        <div class="enhancer-box">
          <div class="tabs">
            <button class="tab active">Basic</button>
            <button class="tab">Advanced</button>
          </div>
          <div class="enhancer-box-body">
            <label class="custom-file-upload">
              <input type="file" name="videoFile" accept="video/*" />
              <img src="imgs/upload.svg" alt="" />
            </label>
            <button class="fancyButton" id="idSubmit" type="button" value="Upload">ENHANCE</button>
          </div>
        </div>
        <div class="preview-box"></div>
      </div>

      <div class="downloadZone">
        <h1>Download your file</h1>
        <input
          class="dashboardInput"
          id="downloadCode"
          type="text"
          placeholder="Enter your download code."
        />
        <button class="fancyButton" id="downloadFile">Download</button>
      </div>
    </main>
    <script>
      let globalUUID;
      document
        .getElementById("idSubmit")
        .addEventListener("click", async (event) => {
          event.preventDefault(); // Prevent the default form submission behavior
          document.getElementById(
            "idSubmit"
          ).innerHTML = `<img src="imgs/loading.gif" class="png-icon" alt="loading">`;
          document.getElementById("idSubmit").setAttribute("disabled", "duck");
          const fileInput = document.querySelector('input[type="file"]');
          const file = fileInput.files[0];

          const formData = new FormData();
          formData.append("videoFile", file);

          try {
            const response = await fetch(
              "http://94.224.211.168:5501/uploader/test@email.com",
              {
                method: "POST",
                body: formData,
              }
            );

            if (response.ok) {
              console.log("File uploaded successfully!");
              data = await response.json();
              console.log(data);
              // alert(data.UUID)
              globalUUID = data.UUID;
              document.getElementById("uuid").innerText = data.UUID;
              document.getElementById("menuModal").style.display = "block";
              // Handle any other logic here (e.g., display a success message)
            } else {
              console.error("Error uploading file:", response.statusText);
              // Handle error cases (e.g., display an error message)
            }
          } catch (error) {
            console.error("An error occurred:", error);
            // Handle network errors or other exceptions
          } finally {
            document.getElementById("idSubmit").innerHTML = `Upload`;
            document.getElementById("idSubmit").removeAttribute("disabled");
          }
          return false;
        });

      document
        .getElementById("closeModal")
        .addEventListener("click", function () {
          document.getElementById("menuModal").style.display = "none";
        });
      // TO DO: This only works on local host, HTTPS required.
      document.getElementById("copy-uuid").addEventListener("click", () => {
        navigator.clipboard.writeText(globalUUID);
        const toast = document.getElementById("toast");
        toast.classList.add("show");
        // Hide the toast after 3 seconds
        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      });

      document.getElementById("downloadFile").addEventListener("click", () => {
        downloadCode = document.getElementById("downloadCode").value;
        window.open(
          `http://94.224.211.168:5501/download/${downloadCode}`,
          "_blank"
        );
      });
    </script>
  </body>
</html>
